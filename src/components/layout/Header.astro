---
import { Image } from "astro:assets";
import USDOTLogo from "@/src/assets/images/DOT-Logo.svg";
import youtubeIcon from "@/src/assets/images/Youtube.png";
import facebookIcon from "@/src/assets/images/Facebook.png";
import instgramIcon from "@/src/assets/images/Instagram.png";
import twitterIcon from "@/src/assets/images/Twitter.png";
import inDeedIcon from "@/src/assets/images/inDeed.png";
import base_url from "@/src/lib/base_url";
import { getTrimmedPathname, navigation } from "@/src/lib/navigation";

const pathname = Astro.url.pathname;
const trimmedPathname = getTrimmedPathname(pathname);
---

<style>
  .top-bar {
    background-color: #091f61;
    width: 100%;
  }
  .top-bar-container{
    height: 50px;
  }
  .header-bar {
    background-image: linear-gradient(to right, #0a1e62, #09638c);
    color: white;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    margin-bottom: 6px;
  }
  .header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
  }
  .siteheader-wrapper {
    flex-shrink: 0;
  }
  a {
    transition: all 0.35s;
  }
  .dot-logo {
    max-height: 2rem;
    object-fit: contain;
  }

  /* Navigation styles (merged from Navigation.astro) */
  nav.navbar {
    flex-grow: 1;
    background-color: transparent !important;
    padding: 0 !important;
    margin-bottom: 0 !important;
    justify-content: flex-end;
  }

  nav.navbar .container-xl {
    padding: 0;
    width: 100%;
    max-width: none;
  }

  nav a,
  nav ul,
  nav li,
  nav button {
    transition: all 0.35s;
  }

  nav a:active {
    background: rgb(198, 198, 198);
    color: black;
  }

  .dropdown-toggle.show {
    color: black;
    background-color: white;
    border-radius: 10px 10px 0px 0px;
  }

  .dropdown-toggle .show {
    color: black;
  }

  .dropdown-menu {
    left: -1px;
  }

  .show.nav-link:focus {
    color: black;
  }

  .dropdown-menu li > ul.dropdown-menu {
    border-radius: 10px;
  }

  .dropend .dropdown-toggle::after {
    content: "\f054";
    border: 0;
    color: #009ad6;
  }

  .dropdown-item.dropdown-toggle.show::after {
    content: "\f078";
    border: 0;
    color: #009ad6;
  }
  .dropdown-item.dropdown-toggle.show {
    background: rgb(233, 236, 239);
    border-radius: 0;
  }
  .dropdown-menu {
    border: none;
  }

  .navbar-nav .nav-item.dropdown.show > .nav-link {
    font-weight: bold;
  }

  /* Show dropdowns on hover for desktop/tablet (keep click behavior on small screens) */
  @media (min-width: 992px) {
    /* main dropdown */
    .navbar-nav .nav-item.dropdown:hover > .dropdown-menu {
      display: block;
      visibility: visible;
      opacity: 1;
      margin-top: 0;
    }

    /* make the toggle appear active on hover */
    .navbar-nav .nav-item.dropdown:hover > .nav-link {
      color: black;
      background-color: white;
      border-radius: 10px 10px 0 0;
    }

    /* nested (dropend) submenu on hover */
    .navbar-nav .dropend:hover > .dropdown-menu {
      display: block;
      visibility: visible;
      opacity: 1;
    }

    /* ensure dropdown-menu default is hidden until hover (desktop) */
    .navbar-nav .dropdown-menu {
      display: none;
    }
  }
.navbar-collapse{
  justify-content: flex-end;
}
  @media (max-width: 992px) {
    .navbar-marginbottom {
      margin-bottom: 0;
    }
  }

  @media (max-width: 1400px) {
    .header-bar {
      flex-wrap: wrap;
    }
    .header-content {
      flex-wrap: wrap;
      width: 100%;
    }
    .siteheader-wrapper {
      flex-basis: 100%;
    }
    nav.navbar {
      flex-grow: 0;
      width: 100%;
      justify-content: flex-start;
      
    }
  }
</style>
<div class="top-bar">
  <div class="container-xl d-flex justify-content-between align-items-center top-bar-container">
    <a href="https://www.transportation.gov/">
      <Image src={USDOTLogo} class="dot-logo" alt="U.S Department of Transportation Logo" />
    </a>
    <div class="d-none d-sm-flex flex-row align-items-center gap-2">
      <a href="https://www.youtube.com/@itsjpo" target="_blank">
        <Image src={youtubeIcon} class="SocialMediaIcon" alt="Youtube Logo" />
      </a>
      <a href="https://www.facebook.com/USDOTResearch" target="_blank">
        <Image src={facebookIcon} class="SocialMediaIcon" alt="Facebook Logo" />
      </a>
      <!-- <a href="https://x.com/ITS_USDOT" target="_blank">
    <Image src={instgramIcon} class="SocialMediaIcon" alt="Instagram Logo" />
    </a> -->
      <a href="https://x.com/ITS_USDOT" target="_blank">
        <Image src={twitterIcon} class="SocialMediaIcon" alt="Twiter Logo" />
      </a>
      <a href="https://www.linkedin.com/company/usdot/" target="_blank">
        <Image src={inDeedIcon} class="SocialMediaIcon" alt="LinkedIn Logo" />
      </a>
    </div>
  </div>
</div>
<div class="header-bar">
  <div class="container-xl">
    <div class="header-content ">
      <div class="siteheader-wrapper">
        <div class="siteheader d-flex justify-content-between ali">
          <a rel="preload" href={base_url("/")} style="text-decoration: none; color: white">
            Intelligent Transportation Systems
            <br />
            Joint Program Office
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbar-content"
            aria-controls="navbar-content"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
      </div>
      <nav class="navbar navbar-expand-lg navbar-dark navbar-marginbottom">
         
        <div class="container-xl">
         
          <div class="collapse navbar-collapse" id="navbar-content">
            <ul class="navbar-nav mb-lg-0">
              {navigation.map(link => (
                <li class:list={["nav-item dropdown", {"activeMenu": trimmedPathname.startsWith(link.url)}]}>
                  <a 
                    class="nav-link py-3 px-4 dropdown-toggle" 
                    id="navbarDropdown" 
                    role="button" 
                    data-bs-toggle="dropdown" 
                    data-bs-auto-close="outside"
                  >
                    {link.name}
                  </a>
                  <ul class="dropdown-menu mt-0 shadow" aria-labelledby="navbarDropdown">
                    {link.pages.map(pageLink => {
                      if (pageLink.isExternal) return (
                        <li>
                          <a class="dropdown-item externalLink" href={pageLink.url} target="_blank" rel="noopener noreferrer">
                            {pageLink.name}
                          </a>
                        </li>
                      );
                      
                      return (
                        <li>
                          <a class="dropdown-item" href={base_url(pageLink.url)}>
                            {pageLink.name}
                          </a>
                        </li>
                      )
                    })}
                  </ul>
                </li>
              ))}
            </ul>
          </div>
        </div>
      </nav>
    </div>
  </div>
</div>
